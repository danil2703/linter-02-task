function findErrors(n,t,i,r,o){const e=n.length-t.length,s=n.slice(0,n.lastIndexOf("{",e)).split("\n").length;let l,c,f=1,a=0;const g=n.split("\n")[s-1].indexOf("{")+1,d=n.split("\n");let h=g;for(let n=s-1;n<d.length;n++){for(let t=h;t<d[n].length;t++)if("{"===d[n][t]&&(f+=1),"}"===d[n][t]&&(a+=1),a===f){l=n+1,c=t+2;break}if(h=0,a===f)break}o.push({code:i,error:r,location:{start:{column:g,line:s},end:{column:c,line:l}}})}function lintGrid(n,t,i,r,o){let e=0;const s=["commercial","offer"];if(n.forEach(n=>{"fraction"===n.elem&&n.elemMods&&s.includes(n.content[0].block)&&(e+=+n.elemMods["m-col"])}),e>i/2){const n="Маркетинговые блоки не могут занимать больше половины от всех колонок блока grid",i="GRID.TOO_MUCH_MARKETING_BLOCKS";findErrors(t,o.str,i,n,r)}}function lint(n){const t=JSON.parse(n);let i=[];const r={h1:!1,h2:!1,warning:{firstText:!1,firstBlock:!1},str:n};return Array.isArray(t)?t.forEach(t=>{lintMain(t,n,i,r)}):lintMain(t,n,i,r),i}function lintMain(n,t,i,r){n.block&&(r.str=r.str.slice(r.str.indexOf(n.block)+n.block.length)),"grid"===n.block&&n.mods&&lintGrid(n.content,t,n.mods["m-columns"],i,r),"text"===n.block&&lintText(n,t,i,r),"warning"===n.block&&(r.warning.firstBlock=!1,r.warning.firstText=!1,r.warningString=t,r.warning.firstText=findFirst(n,r),lintWarning(n,t,i,r)),Array.isArray(n.content)?n.content.forEach(n=>{lintMain(n,t,i,r)}):"object"==typeof n.content&&lintMain(n.content,t,i,r)}function lintText(n,t,i,r){if(n.mods){if("h1"===n.mods.type){if(r.h1){const n="Заголовок первого уровня на странице должен быть единственным",o="TEXT.SEVERAL_H1";findErrors(t,r.str,o,n,i)}r.h1=!0}if("h2"===n.mods.type){if(!r.h1){const n="Заголовок второго уровня не может находиться перед заголовком первого уровня",o="TEXT.INVALID_H2_POSITION";findErrors(t,r.str,o,n,i)}r.h2=!0}if("h3"===n.mods.type&&!r.h2){const n="Заголовок третьего уровня не должен быть перед второго уровня",o="TEXT.INVALID_H3_POSITION";findErrors(t,r.str,o,n,i)}}}function lintWarning(n,t,i,r){if(n.block&&(r.warningString=r.warningString.slice(r.warningString.indexOf(n.block)+n.block.length)),"placeholder"===n.block&&(lintWarningPlaceholder(n,t,i,r),r.warning.firstBlock||(r.warning.firstBlock="placeholder")),"text"===n.block&&n.mods&&r.warning.firstText!==n.mods.size){const n="Тексты в блоке warning должны быть одного размера",o="WARNING.TEXT_SIZES_SHOULD_BE_EQUAL";findErrors(t,r.str,o,n,i)}if("button"===n.block&&(lintWarningButton(n,t,i,r),!r.warning.firstBlock)){const n="Блок button в блоке warning не может находиться перед блоком placeholder",o="WARNING.INVALID_BUTTON_POSITION";findErrors(t,r.warningString,o,n,i)}if(Array.isArray(n.content))n.content.forEach(n=>{"warning"!==n.block&&lintWarning(n,t,i,r)});else if("object"==typeof n.content)for(const o in n.content)lintWarning(n.content[o],t,i,r)}function lintWarningButton(n,t,i,r){let o;if(["s","m","l","xl","xxl"].forEach((n,t,i)=>{n===r.warning.firstText&&(o=i[t+1])}),n.mods&&n.mods.size!==o){const n="Размер кнопки блока warning должен быть на 1 шаг больше эталонного",o="WARNING.INVALID_BUTTON_SIZE";findErrors(t,r.warningString,o,n,i)}}function findFirst(n,t){if("text"===n.block&&n.mods&&n.mods.size&&!t.warning.firstText)return n.mods.size;if(Array.isArray(n.content))n.content.forEach(n=>{t.warning.firstText||(t.warning.firstText=findFirst(n,t))});else if("object"==typeof n.content)for(const i in n.content)t.warning.firstText=findFirst(n.content[i],t);return t.warning.firstText}function lintWarningPlaceholder(n,t,i,r){let o;if(n.mods&&(o=n.mods.size),"s"!==o&&"m"!==o&&"l"!==o){const n="Допустимые размеры для блока placeholder в блоке warning: s, m, l",o="WARNING.INVALID_PLACEHOLDER_SIZE";findErrors(t,r.warningString,o,n,i)}}